{"file_contents":{"app.py":{"content":"from flask import Flask, render_template, request, redirect, url_for, jsonify, make_response\nimport sqlite3\nimport os\nfrom datetime import datetime, date\nfrom collections import defaultdict\nimport calendar\nimport csv\nimport io\n\n# Get the directory of the current script for absolute paths\nbasedir = os.path.abspath(os.path.dirname(__file__))\n\napp = Flask(__name__, \n            template_folder=os.path.join(basedir, 'templates'),\n            static_folder=os.path.join(basedir, 'static'))\n\n# Configuration from environment variables\napp.config['SECRET_KEY'] = os.environ.get('SESSION_SECRET', 'dev-secret-key')\napp.config['APP_NAME'] = os.environ.get('APP_NAME', 'FinTrack')\napp.config['APP_VERSION'] = os.environ.get('APP_VERSION', '1.0.0')\n\n# Database configuration\nDATABASE = os.environ.get('DATABASE_PATH', os.path.join(basedir, 'finance.db'))\nif not os.path.isabs(DATABASE):\n    DATABASE = os.path.join(basedir, DATABASE)\n\ndef init_db():\n    \"\"\"Initialize the SQLite database\"\"\"\n    conn = sqlite3.connect(DATABASE)\n    cursor = conn.cursor()\n    cursor.execute('''\n        CREATE TABLE IF NOT EXISTS transactions (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            amount REAL NOT NULL,\n            category TEXT NOT NULL,\n            type TEXT NOT NULL CHECK (type IN ('income', 'expense')),\n            date TEXT NOT NULL,\n            notes TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n    ''')\n    cursor.execute('''\n        CREATE TABLE IF NOT EXISTS categories (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            name TEXT NOT NULL UNIQUE,\n            type TEXT NOT NULL CHECK (type IN ('income', 'expense')),\n            is_custom INTEGER DEFAULT 1,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n    ''')\n    \n    # Insert default categories if they don't exist\n    default_income_categories = [\n        'Salary', 'Freelance', 'Business', 'Investments', \n        'Rental Income', 'Gifts', 'Other Income'\n    ]\n    default_expense_categories = [\n        'Food & Dining', 'Shopping', 'Transportation', 'Bills & Utilities',\n        'Entertainment', 'Healthcare', 'Travel', 'Education',\n        'Groceries', 'Rent/Mortgage', 'Insurance', 'Other Expenses'\n    ]\n    \n    for category in default_income_categories:\n        cursor.execute('''\n            INSERT OR IGNORE INTO categories (name, type, is_custom)\n            VALUES (?, 'income', 0)\n        ''', (category,))\n    \n    for category in default_expense_categories:\n        cursor.execute('''\n            INSERT OR IGNORE INTO categories (name, type, is_custom)\n            VALUES (?, 'expense', 0)\n        ''', (category,))\n    \n    conn.commit()\n    conn.close()\n\ndef get_db_connection():\n    \"\"\"Get database connection\"\"\"\n    conn = sqlite3.connect(DATABASE)\n    conn.row_factory = sqlite3.Row\n    return conn\n\n@app.route('/')\ndef dashboard():\n    \"\"\"Main dashboard page\"\"\"\n    return render_template('index.html')\n\n@app.route('/add')\ndef add_transaction_page():\n    \"\"\"Add transaction page\"\"\"\n    return render_template('add.html')\n\n@app.route('/categories')\ndef categories_page():\n    \"\"\"Categories management page\"\"\"\n    return render_template('categories.html')\n\n@app.route('/api/transactions', methods=['GET', 'POST'])\ndef transactions_api():\n    \"\"\"API endpoint for transactions\"\"\"\n    if request.method == 'POST':\n        # Add new transaction\n        data = request.get_json()\n        \n        conn = get_db_connection()\n        cursor = conn.cursor()\n        cursor.execute('''\n            INSERT INTO transactions (amount, category, type, date, notes)\n            VALUES (?, ?, ?, ?, ?)\n        ''', (\n            float(data['amount']),\n            data['category'],\n            data['type'],\n            data['date'],\n            data.get('notes', '')\n        ))\n        conn.commit()\n        conn.close()\n        \n        return jsonify({'success': True, 'message': 'Transaction added successfully'})\n    \n    else:\n        # Get transactions with optional date filtering\n        start_date = request.args.get('start_date')\n        end_date = request.args.get('end_date')\n        \n        conn = get_db_connection()\n        query = 'SELECT * FROM transactions'\n        params = []\n        \n        if start_date and end_date:\n            query += ' WHERE date BETWEEN ? AND ?'\n            params = [start_date, end_date]\n        \n        query += ' ORDER BY date DESC'\n        \n        transactions = conn.execute(query, params).fetchall()\n        conn.close()\n        \n        # Convert to list of dictionaries\n        transactions_list = []\n        for transaction in transactions:\n            transactions_list.append({\n                'id': transaction['id'],\n                'amount': transaction['amount'],\n                'category': transaction['category'],\n                'type': transaction['type'],\n                'date': transaction['date'],\n                'notes': transaction['notes'],\n                'created_at': transaction['created_at']\n            })\n        \n        return jsonify(transactions_list)\n\n@app.route('/api/transactions/<int:transaction_id>', methods=['GET', 'PUT', 'DELETE'])\ndef transaction_detail_api(transaction_id):\n    \"\"\"API endpoint for individual transaction operations\"\"\"\n    conn = get_db_connection()\n    \n    if request.method == 'GET':\n        # Get single transaction\n        transaction = conn.execute(\n            'SELECT * FROM transactions WHERE id = ?', \n            (transaction_id,)\n        ).fetchone()\n        conn.close()\n        \n        if transaction:\n            return jsonify({\n                'id': transaction['id'],\n                'amount': transaction['amount'],\n                'category': transaction['category'],\n                'type': transaction['type'],\n                'date': transaction['date'],\n                'notes': transaction['notes'],\n                'created_at': transaction['created_at']\n            })\n        else:\n            return jsonify({'error': 'Transaction not found'}), 404\n    \n    elif request.method == 'PUT':\n        # Update transaction\n        data = request.get_json()\n        \n        cursor = conn.cursor()\n        cursor.execute('''\n            UPDATE transactions \n            SET amount = ?, category = ?, type = ?, date = ?, notes = ?\n            WHERE id = ?\n        ''', (\n            float(data['amount']),\n            data['category'],\n            data['type'],\n            data['date'],\n            data.get('notes', ''),\n            transaction_id\n        ))\n        \n        if cursor.rowcount == 0:\n            conn.close()\n            return jsonify({'error': 'Transaction not found'}), 404\n        \n        conn.commit()\n        conn.close()\n        \n        return jsonify({'success': True, 'message': 'Transaction updated successfully'})\n    \n    elif request.method == 'DELETE':\n        # Delete transaction\n        cursor = conn.cursor()\n        cursor.execute('DELETE FROM transactions WHERE id = ?', (transaction_id,))\n        \n        if cursor.rowcount == 0:\n            conn.close()\n            return jsonify({'error': 'Transaction not found'}), 404\n        \n        conn.commit()\n        conn.close()\n        \n        return jsonify({'success': True, 'message': 'Transaction deleted successfully'})\n\n@app.route('/api/summary')\ndef summary_api():\n    \"\"\"API endpoint for financial summary\"\"\"\n    start_date = request.args.get('start_date')\n    end_date = request.args.get('end_date')\n    \n    conn = get_db_connection()\n    query = 'SELECT type, amount FROM transactions'\n    params = []\n    \n    if start_date and end_date:\n        query += ' WHERE date BETWEEN ? AND ?'\n        params = [start_date, end_date]\n    \n    transactions = conn.execute(query, params).fetchall()\n    conn.close()\n    \n    total_income = sum(t['amount'] for t in transactions if t['type'] == 'income')\n    total_expense = sum(t['amount'] for t in transactions if t['type'] == 'expense')\n    balance = total_income - total_expense\n    \n    return jsonify({\n        'total_income': total_income,\n        'total_expense': total_expense,\n        'balance': balance\n    })\n\n@app.route('/api/monthly-data')\ndef monthly_data_api():\n    \"\"\"API endpoint for monthly income vs expense data\"\"\"\n    start_date = request.args.get('start_date')\n    end_date = request.args.get('end_date')\n    \n    conn = get_db_connection()\n    query = 'SELECT type, amount, date FROM transactions'\n    params = []\n    \n    if start_date and end_date:\n        query += ' WHERE date BETWEEN ? AND ?'\n        params = [start_date, end_date]\n    \n    query += ' ORDER BY date'\n    \n    transactions = conn.execute(query, params).fetchall()\n    conn.close()\n    \n    monthly_data = defaultdict(lambda: {'income': 0, 'expense': 0})\n    \n    for transaction in transactions:\n        transaction_date = datetime.strptime(transaction['date'], '%Y-%m-%d')\n        month_key = transaction_date.strftime('%Y-%m')\n        monthly_data[month_key][transaction['type']] += transaction['amount']\n    \n    # Convert to format suitable for Chart.js\n    months = sorted(monthly_data.keys())\n    income_data = [monthly_data[month]['income'] for month in months]\n    expense_data = [monthly_data[month]['expense'] for month in months]\n    \n    # Format month labels\n    month_labels = []\n    for month in months:\n        date_obj = datetime.strptime(month, '%Y-%m')\n        month_labels.append(date_obj.strftime('%b %Y'))\n    \n    return jsonify({\n        'labels': month_labels,\n        'income': income_data,\n        'expenses': expense_data\n    })\n\n@app.route('/api/category-data')\ndef category_data_api():\n    \"\"\"API endpoint for expense distribution by category\"\"\"\n    start_date = request.args.get('start_date')\n    end_date = request.args.get('end_date')\n    \n    conn = get_db_connection()\n    query = 'SELECT category, SUM(amount) as total FROM transactions WHERE type = \"expense\"'\n    params = []\n    \n    if start_date and end_date:\n        query += ' AND date BETWEEN ? AND ?'\n        params = [start_date, end_date]\n    \n    query += ' GROUP BY category'\n    \n    categories = conn.execute(query, params).fetchall()\n    conn.close()\n    \n    labels = [cat['category'] for cat in categories]\n    data = [cat['total'] for cat in categories]\n    \n    return jsonify({\n        'labels': labels,\n        'data': data\n    })\n\n@app.route('/api/categories', methods=['GET', 'POST'])\ndef categories_api():\n    \"\"\"API endpoint for categories management\"\"\"\n    conn = get_db_connection()\n    \n    if request.method == 'POST':\n        # Add new custom category\n        data = request.get_json()\n        \n        cursor = conn.cursor()\n        try:\n            cursor.execute('''\n                INSERT INTO categories (name, type, is_custom)\n                VALUES (?, ?, 1)\n            ''', (data['name'], data['type']))\n            conn.commit()\n            conn.close()\n            return jsonify({'success': True, 'message': 'Category added successfully'})\n        except sqlite3.IntegrityError:\n            conn.close()\n            return jsonify({'error': 'Category already exists'}), 400\n    \n    else:\n        # Get all categories\n        category_type = request.args.get('type')  # 'income' or 'expense'\n        query = 'SELECT * FROM categories'\n        params = []\n        \n        if category_type:\n            query += ' WHERE type = ?'\n            params = [category_type]\n        \n        query += ' ORDER BY name'\n        \n        categories = conn.execute(query, params).fetchall()\n        conn.close()\n        \n        categories_list = []\n        for category in categories:\n            categories_list.append({\n                'id': category['id'],\n                'name': category['name'],\n                'type': category['type'],\n                'is_custom': category['is_custom'],\n                'created_at': category['created_at']\n            })\n        \n        return jsonify(categories_list)\n\n@app.route('/api/categories/<int:category_id>', methods=['DELETE'])\ndef delete_category_api(category_id):\n    \"\"\"API endpoint to delete custom category\"\"\"\n    conn = get_db_connection()\n    \n    # Check if category is custom (can only delete custom categories)\n    category = conn.execute(\n        'SELECT * FROM categories WHERE id = ? AND is_custom = 1',\n        (category_id,)\n    ).fetchone()\n    \n    if not category:\n        conn.close()\n        return jsonify({'error': 'Category not found or cannot be deleted'}), 404\n    \n    # Check if category is being used in transactions\n    usage_count = conn.execute(\n        'SELECT COUNT(*) as count FROM transactions WHERE category = ?',\n        (category['name'],)\n    ).fetchone()['count']\n    \n    if usage_count > 0:\n        conn.close()\n        return jsonify({'error': f'Cannot delete category. It is used in {usage_count} transactions.'}), 400\n    \n    # Delete the category\n    cursor = conn.cursor()\n    cursor.execute('DELETE FROM categories WHERE id = ?', (category_id,))\n    conn.commit()\n    conn.close()\n    \n    return jsonify({'success': True, 'message': 'Category deleted successfully'})\n\n@app.route('/api/export/csv')\ndef export_csv():\n    \"\"\"Export transactions to CSV\"\"\"\n    start_date = request.args.get('start_date')\n    end_date = request.args.get('end_date')\n    \n    conn = get_db_connection()\n    query = '''\n        SELECT id, amount, category, type, date, notes, created_at\n        FROM transactions\n    '''\n    params = []\n    \n    if start_date and end_date:\n        query += ' WHERE date BETWEEN ? AND ?'\n        params = [start_date, end_date]\n    \n    query += ' ORDER BY date DESC'\n    \n    transactions = conn.execute(query, params).fetchall()\n    conn.close()\n    \n    # Create CSV content\n    output = io.StringIO()\n    writer = csv.writer(output)\n    \n    # Write headers\n    writer.writerow(['ID', 'Amount', 'Category', 'Type', 'Date', 'Notes', 'Created At'])\n    \n    # Write data with formula injection protection\n    for transaction in transactions:\n        # Protect against formula injection by prefixing dangerous characters\n        notes = transaction['notes'] or ''\n        if notes and notes[0] in ['=', '+', '-', '@']:\n            notes = \"'\" + notes  # Prefix with apostrophe to neutralize formulas\n            \n        category = transaction['category']\n        if category and category[0] in ['=', '+', '-', '@']:\n            category = \"'\" + category\n        \n        writer.writerow([\n            transaction['id'],\n            transaction['amount'],\n            category,\n            transaction['type'],\n            transaction['date'],\n            notes,\n            transaction['created_at']\n        ])\n    \n    # Create response\n    response = make_response(output.getvalue())\n    response.headers['Content-Type'] = 'text/csv'\n    \n    # Generate filename with date range if provided\n    if start_date and end_date:\n        filename = f'fintrack_transactions_{start_date}_to_{end_date}.csv'\n    else:\n        filename = f'fintrack_transactions_{datetime.now().strftime(\"%Y-%m-%d\")}.csv'\n    \n    response.headers['Content-Disposition'] = f'attachment; filename={filename}'\n    \n    return response\n\n@app.route('/api/import/csv', methods=['POST'])\ndef import_csv():\n    \"\"\"Import transactions from CSV\"\"\"\n    if 'file' not in request.files:\n        return jsonify({'error': 'No file uploaded'}), 400\n    \n    file = request.files['file']\n    if not file.filename or file.filename == '':\n        return jsonify({'error': 'No file selected'}), 400\n    \n    if not file.filename.lower().endswith('.csv'):\n        return jsonify({'error': 'File must be a CSV'}), 400\n    \n    try:\n        # Read CSV content\n        content = file.read().decode('utf-8')\n        csv_data = csv.DictReader(io.StringIO(content))\n        \n        conn = get_db_connection()\n        cursor = conn.cursor()\n        \n        imported_count = 0\n        skipped_count = 0\n        \n        for row in csv_data:\n            try:\n                # Validate required fields\n                if not all([row.get('Amount'), row.get('Category'), row.get('Type'), row.get('Date')]):\n                    skipped_count += 1\n                    continue\n                \n                # Validate amount\n                try:\n                    amount = float(row['Amount'])\n                except (ValueError, TypeError):\n                    skipped_count += 1\n                    continue\n                \n                # Validate type\n                if row['Type'].lower() not in ['income', 'expense']:\n                    skipped_count += 1\n                    continue\n                \n                # Validate date format\n                try:\n                    datetime.strptime(row['Date'], '%Y-%m-%d')\n                except ValueError:\n                    skipped_count += 1\n                    continue\n                \n                # Insert transaction (skip if ID already exists)\n                cursor.execute('''\n                    INSERT INTO transactions (amount, category, type, date, notes)\n                    VALUES (?, ?, ?, ?, ?)\n                ''', (\n                    amount,\n                    row['Category'],\n                    row['Type'].lower(),\n                    row['Date'],\n                    row.get('Notes', '')\n                ))\n                imported_count += 1\n                \n            except Exception as e:\n                print(f\"Error importing row: {e}\")\n                skipped_count += 1\n                continue\n        \n        conn.commit()\n        conn.close()\n        \n        return jsonify({\n            'success': True,\n            'message': f'Import completed. {imported_count} transactions imported, {skipped_count} skipped.',\n            'imported': imported_count,\n            'skipped': skipped_count\n        })\n    \n    except Exception as e:\n        return jsonify({'error': f'Error processing file: {str(e)}'}), 400\n\nif __name__ == '__main__':\n    init_db()\n    \n    # Get Flask configuration from environment variables\n    flask_host = os.environ.get('FLASK_HOST', '0.0.0.0')\n    flask_port = int(os.environ.get('FLASK_PORT', 5000))\n    flask_debug = os.environ.get('FLASK_DEBUG', 'True').lower() == 'true'\n    \n    app.run(host=flask_host, port=flask_port, debug=flask_debug)","size_bytes":18281},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"flask>=3.1.2\",\n]\n","size_bytes":164},"replit.md":{"content":"# FinTrack - Personal Finance Tracker\n\n## Overview\nFinTrack is a personal finance tracking web application built with Flask (Python) backend and modern web technologies. It allows users to track income and expenses with comprehensive visualization and filtering capabilities.\n\n## Recent Changes\n- **2025-09-21**: Created complete FinTrack application with Flask backend, SQLite database, HTML/CSS/JavaScript frontend, and Chart.js visualizations\n\n## Project Architecture\n\n### Backend (Flask)\n- **app.py**: Main Flask application with API endpoints\n  - SQLite database integration\n  - Transaction CRUD operations\n  - Summary and analytics API endpoints\n  - Monthly and category-based data aggregation\n\n### Database Schema (SQLite)\n- **transactions table**: \n  - id (PRIMARY KEY)\n  - amount (REAL)\n  - category (TEXT)\n  - type (TEXT: 'income' or 'expense')\n  - date (TEXT: YYYY-MM-DD format)\n  - notes (TEXT, optional)\n  - created_at (TIMESTAMP)\n\n### Frontend Structure\n- **templates/**:\n  - base.html: Base template with Bootstrap and Chart.js\n  - index.html: Dashboard with summary cards, charts, and transaction list\n  - add.html: Transaction entry form\n\n- **static/**:\n  - css/style.css: Custom styling with Bootstrap enhancements\n  - js/app.js: JavaScript for dashboard functionality and Chart.js integration\n\n## Features\n- ✅ Add income/expense transactions with categorization\n- ✅ SQLite database storage\n- ✅ Dashboard with financial summary cards\n- ✅ Bar chart for monthly income vs expenses\n- ✅ Pie chart for expense category distribution\n- ✅ Date range filtering\n- ✅ Responsive Bootstrap UI\n- ✅ Real-time data updates\n\n## Tech Stack\n- **Backend**: Flask (Python), SQLite\n- **Frontend**: HTML5, CSS3, JavaScript (ES6)\n- **UI Framework**: Bootstrap 5\n- **Charts**: Chart.js\n- **Icons**: Bootstrap Icons\n\n## Current State\nThe application is fully functional with a running Flask development server on port 5000. All core features are implemented and tested.","size_bytes":1977},"static/css/style.css":{"content":"/* Custom Styles for FinTrack */\n\n:root {\n    --primary-color: #0d6efd;\n    --success-color: #198754;\n    --danger-color: #dc3545;\n    --warning-color: #ffc107;\n    --info-color: #0dcaf0;\n    --light-bg: #f8f9fa;\n    \n    /* Light theme variables */\n    --bg-color: #f8f9fa;\n    --text-color: #212529;\n    --card-bg: #ffffff;\n    --border-color: rgba(0, 0, 0, 0.125);\n    --navbar-bg: #0d6efd;\n    --navbar-text: #ffffff;\n}\n\n/* Dark theme variables */\n[data-theme=\"dark\"] {\n    --bg-color: #212529;\n    --text-color: #f8f9fa;\n    --card-bg: #343a40;\n    --border-color: rgba(255, 255, 255, 0.125);\n    --navbar-bg: #1a1f24;\n    --navbar-text: #f8f9fa;\n    --light-bg: #212529;\n}\n\nbody {\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    overflow-x: hidden;\n    transition: background-color 0.3s ease, color 0.3s ease;\n}\n\n/* Navbar theming */\n.navbar-dark {\n    background-color: var(--navbar-bg) !important;\n}\n\n.navbar-dark .navbar-nav .nav-link {\n    color: var(--navbar-text) !important;\n}\n\n.navbar-dark .navbar-brand {\n    color: var(--navbar-text) !important;\n}\n\n/* Theme toggle button */\n#theme-toggle {\n    color: var(--navbar-text) !important;\n    border: none;\n    background: none;\n    padding: 0.5rem;\n}\n\n#theme-toggle:hover {\n    color: rgba(255, 255, 255, 0.75) !important;\n}\n\n/* Container and Layout Improvements */\n.container {\n    max-width: 100%;\n    padding-left: 15px;\n    padding-right: 15px;\n}\n\n@media (min-width: 576px) {\n    .container {\n        max-width: 540px;\n    }\n}\n\n@media (min-width: 768px) {\n    .container {\n        max-width: 720px;\n    }\n}\n\n@media (min-width: 992px) {\n    .container {\n        max-width: 960px;\n    }\n}\n\n@media (min-width: 1200px) {\n    .container {\n        max-width: 1140px;\n    }\n}\n\n.navbar-brand {\n    font-weight: bold;\n    font-size: 1.5rem;\n}\n\n.card {\n    border: none;\n    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);\n    border-radius: 0.5rem;\n    transition: box-shadow 0.15s ease-in-out;\n}\n\n.card:hover {\n    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);\n}\n\n.card-header {\n    background-color: var(--card-bg);\n    border-bottom: 1px solid var(--border-color);\n    font-weight: 600;\n    color: var(--text-color);\n}\n\n/* Summary Cards */\n.card.bg-success,\n.card.bg-danger,\n.card.bg-warning,\n.card.bg-info {\n    border: none;\n}\n\n#balance-card.bg-success {\n    background-color: var(--success-color) !important;\n}\n\n#balance-card.bg-danger {\n    background-color: var(--danger-color) !important;\n}\n\n#balance-card.bg-warning {\n    background-color: var(--warning-color) !important;\n    color: #000 !important;\n}\n\n/* Form Styling */\n.form-control:focus,\n.form-select:focus {\n    border-color: var(--primary-color);\n    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);\n}\n\n.btn {\n    border-radius: 0.375rem;\n    font-weight: 500;\n}\n\n.btn-primary {\n    background-color: var(--primary-color);\n    border-color: var(--primary-color);\n}\n\n.btn-primary:hover {\n    background-color: #0b5ed7;\n    border-color: #0a58ca;\n}\n\n/* Table Styling */\n.table-striped > tbody > tr:nth-of-type(odd) > td {\n    background-color: rgba(0, 0, 0, 0.02);\n}\n\n.table th {\n    border-top: none;\n    font-weight: 600;\n    color: #495057;\n}\n\n/* Transaction Type Badges */\n.badge-income {\n    background-color: var(--success-color);\n}\n\n.badge-expense {\n    background-color: var(--danger-color);\n}\n\n/* Chart Container - Improved Responsiveness */\n.chart-container {\n    position: relative;\n    height: 300px;\n    width: 100%;\n}\n\n#monthly-chart, #category-chart {\n    max-width: 100%;\n    height: auto !important;\n}\n\n/* Table Responsiveness */\n.table-responsive {\n    border: none;\n    overflow-x: auto;\n    -webkit-overflow-scrolling: touch;\n}\n\n.table {\n    margin-bottom: 0;\n    min-width: 100%;\n    white-space: nowrap;\n    color: var(--text-color);\n}\n\n.table-striped > tbody > tr:nth-of-type(odd) > td {\n    background-color: var(--border-color);\n}\n\n.table th {\n    color: var(--text-color);\n    border-color: var(--border-color);\n}\n\n.table td {\n    border-color: var(--border-color);\n}\n\n/* Prevent horizontal scroll issues */\n.row {\n    margin-left: 0;\n    margin-right: 0;\n}\n\n.col-md-4, .col-md-6, .col-md-8, .col-12 {\n    padding-left: 7.5px;\n    padding-right: 7.5px;\n}\n\n/* Card adjustments for small screens */\n.card {\n    margin-bottom: 1rem;\n    border: 1px solid var(--border-color);\n    background-color: var(--card-bg);\n    color: var(--text-color);\n    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);\n    border-radius: 0.5rem;\n    transition: all 0.3s ease;\n    overflow: hidden;\n}\n\n.card-body {\n    padding: 1rem;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n}\n\n/* Loading Spinner */\n.spinner-border-sm {\n    width: 1rem;\n    height: 1rem;\n}\n\n/* Enhanced Responsive Adjustments */\n@media (max-width: 768px) {\n    .navbar-nav {\n        text-align: center;\n    }\n    \n    .card-body h3 {\n        font-size: 1.5rem;\n    }\n    \n    .fs-1 {\n        font-size: 2rem !important;\n    }\n    \n    /* Make charts stack on mobile */\n    .col-md-8, .col-md-4 {\n        margin-bottom: 1rem;\n    }\n    \n    /* Smaller margins on mobile */\n    .container {\n        padding-left: 10px;\n        padding-right: 10px;\n    }\n    \n    /* Better spacing for mobile */\n    .my-4 {\n        margin-top: 1.5rem !important;\n        margin-bottom: 1.5rem !important;\n    }\n    \n    /* Adjust table text size for better mobile readability */\n    .table td, .table th {\n        font-size: 0.875rem;\n        padding: 0.5rem;\n    }\n}\n\n@media (max-width: 576px) {\n    .card-body h3 {\n        font-size: 1.25rem;\n    }\n    \n    .fs-1 {\n        font-size: 1.5rem !important;\n    }\n    \n    /* Extra small screen adjustments */\n    .navbar-brand {\n        font-size: 1.25rem;\n    }\n    \n    .container {\n        padding-left: 5px;\n        padding-right: 5px;\n    }\n    \n    /* Stack form elements on very small screens */\n    .col-md-4 .form-control,\n    .col-md-4 .btn {\n        margin-bottom: 0.5rem;\n    }\n}\n\n/* Toast Notifications */\n.toast {\n    backdrop-filter: blur(10px);\n}\n\n/* Animation for number changes */\n@keyframes countUp {\n    from {\n        opacity: 0.5;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.count-animation {\n    animation: countUp 0.3s ease-out;\n}\n\n/* Empty State */\n.empty-state {\n    text-align: center;\n    padding: 3rem 1rem;\n    color: #6c757d;\n}\n\n.empty-state i {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    opacity: 0.5;\n}","size_bytes":6555},"static/js/app.js":{"content":"// FinTrack JavaScript Application\n\n// Global variables for charts\nlet monthlyChart = null;\nlet categoryChart = null;\n\n// Category options loaded from database\nlet categories = {\n    income: [],\n    expense: []\n};\n\n// Load categories from API\nasync function loadCategories() {\n    try {\n        const response = await fetch('/api/categories');\n        const data = await response.json();\n        categories.income = data.filter(cat => cat.type === 'income').map(cat => cat.name);\n        categories.expense = data.filter(cat => cat.type === 'expense').map(cat => cat.name);\n        return categories;\n    } catch (error) {\n        console.error('Error loading categories:', error);\n        // Fallback to default categories if API fails\n        categories = {\n            income: ['Salary', 'Freelance', 'Business', 'Investments', 'Rental Income', 'Gifts', 'Other Income'],\n            expense: ['Food & Dining', 'Shopping', 'Transportation', 'Bills & Utilities', 'Entertainment', 'Healthcare', 'Travel', 'Education', 'Groceries', 'Rent/Mortgage', 'Insurance', 'Other Expenses']\n        };\n        return categories;\n    }\n}\n\n// Initialize dashboard when page loads\ndocument.addEventListener('DOMContentLoaded', async function() {\n    const currentPage = window.location.pathname;\n    \n    // Initialize theme\n    initializeTheme();\n    \n    // Load categories first and wait for completion\n    await loadCategories();\n    \n    if (currentPage === '/' || currentPage.includes('index')) {\n        initializeDashboard();\n        initializeEditModal();\n    } else if (currentPage.includes('add')) {\n        initializeAddTransaction();\n    } else if (currentPage.includes('categories')) {\n        initializeCategoriesPage();\n    }\n});\n\n// Initialize edit modal functionality\nfunction initializeEditModal() {\n    const editTypeSelect = document.getElementById('edit-type');\n    const editForm = document.getElementById('edit-transaction-form');\n    \n    if (editTypeSelect) {\n        editTypeSelect.addEventListener('change', function() {\n            updateEditCategoryOptions(this.value, '');\n        });\n    }\n    \n    if (editForm) {\n        editForm.addEventListener('submit', handleEditTransactionSubmit);\n    }\n}\n\n// Dashboard Functions\nfunction initializeDashboard() {\n    loadSummaryData();\n    loadTransactions();\n    loadCharts();\n}\n\nfunction loadSummaryData(startDate = '', endDate = '') {\n    let url = '/api/summary';\n    if (startDate && endDate) {\n        url += `?start_date=${startDate}&end_date=${endDate}`;\n    }\n    \n    fetch(url)\n        .then(response => response.json())\n        .then(data => {\n            updateSummaryCards(data);\n        })\n        .catch(error => {\n            console.error('Error loading summary data:', error);\n        });\n}\n\nfunction updateSummaryCards(data) {\n    const totalIncomeEl = document.getElementById('total-income');\n    const totalExpenseEl = document.getElementById('total-expense');\n    const balanceEl = document.getElementById('balance');\n    const balanceCard = document.getElementById('balance-card');\n    \n    if (totalIncomeEl) totalIncomeEl.textContent = formatCurrency(data.total_income);\n    if (totalExpenseEl) totalExpenseEl.textContent = formatCurrency(data.total_expense);\n    if (balanceEl) balanceEl.textContent = formatCurrency(data.balance);\n    \n    // Update balance card color based on positive/negative balance\n    if (balanceCard) {\n        balanceCard.className = 'card text-white';\n        if (data.balance >= 0) {\n            balanceCard.classList.add('bg-success');\n        } else {\n            balanceCard.classList.add('bg-danger');\n        }\n    }\n}\n\nfunction loadTransactions(startDate = '', endDate = '') {\n    let url = '/api/transactions';\n    if (startDate && endDate) {\n        url += `?start_date=${startDate}&end_date=${endDate}`;\n    }\n    \n    fetch(url)\n        .then(response => response.json())\n        .then(data => {\n            displayTransactions(data);\n        })\n        .catch(error => {\n            console.error('Error loading transactions:', error);\n        });\n}\n\nfunction displayTransactions(transactions) {\n    const tbody = document.getElementById('transactions-table');\n    \n    if (transactions.length === 0) {\n        tbody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center text-muted\">No transactions found</td></tr>';\n        return;\n    }\n    \n    // Clear existing content\n    tbody.innerHTML = '';\n    \n    // Create rows safely using DOM APIs\n    transactions.forEach(transaction => {\n        const row = document.createElement('tr');\n        \n        // Date column\n        const dateCell = document.createElement('td');\n        dateCell.textContent = formatDate(transaction.date);\n        row.appendChild(dateCell);\n        \n        // Category column (safe text content)\n        const categoryCell = document.createElement('td');\n        categoryCell.textContent = transaction.category;\n        row.appendChild(categoryCell);\n        \n        // Type column\n        const typeCell = document.createElement('td');\n        const badge = document.createElement('span');\n        badge.className = `badge badge-${transaction.type}`;\n        badge.textContent = transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1);\n        typeCell.appendChild(badge);\n        row.appendChild(typeCell);\n        \n        // Amount column\n        const amountCell = document.createElement('td');\n        amountCell.className = transaction.type === 'income' ? 'text-success' : 'text-danger';\n        amountCell.textContent = `${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}`;\n        row.appendChild(amountCell);\n        \n        // Notes column (safe text content)\n        const notesCell = document.createElement('td');\n        notesCell.textContent = transaction.notes || '-';\n        row.appendChild(notesCell);\n        \n        // Actions column\n        const actionsCell = document.createElement('td');\n        const btnGroup = document.createElement('div');\n        btnGroup.className = 'btn-group';\n        btnGroup.setAttribute('role', 'group');\n        \n        const editBtn = document.createElement('button');\n        editBtn.type = 'button';\n        editBtn.className = 'btn btn-sm btn-outline-primary';\n        editBtn.onclick = () => editTransaction(transaction.id);\n        editBtn.innerHTML = '<i class=\"bi bi-pencil\"></i>';\n        btnGroup.appendChild(editBtn);\n        \n        const deleteBtn = document.createElement('button');\n        deleteBtn.type = 'button';\n        deleteBtn.className = 'btn btn-sm btn-outline-danger';\n        deleteBtn.onclick = () => deleteTransaction(transaction.id);\n        deleteBtn.innerHTML = '<i class=\"bi bi-trash\"></i>';\n        btnGroup.appendChild(deleteBtn);\n        \n        actionsCell.appendChild(btnGroup);\n        row.appendChild(actionsCell);\n        \n        tbody.appendChild(row);\n    });\n}\n\nfunction loadCharts() {\n    loadMonthlyChart();\n    loadCategoryChart();\n}\n\nfunction loadMonthlyChart(startDate = '', endDate = '') {\n    let url = '/api/monthly-data';\n    if (startDate && endDate) {\n        url += `?start_date=${startDate}&end_date=${endDate}`;\n    }\n    \n    fetch(url)\n        .then(response => response.json())\n        .then(data => {\n            createMonthlyChart(data);\n        })\n        .catch(error => {\n            console.error('Error loading monthly chart data:', error);\n        });\n}\n\nfunction createMonthlyChart(data) {\n    const ctx = document.getElementById('monthly-chart');\n    if (!ctx) return;\n    \n    if (monthlyChart) {\n        monthlyChart.destroy();\n    }\n    \n    const currentTheme = document.documentElement.getAttribute('data-theme');\n    const textColor = currentTheme === 'dark' ? '#f8f9fa' : '#212529';\n    const gridColor = currentTheme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n    \n    monthlyChart = new Chart(ctx, {\n        type: 'bar',\n        data: {\n            labels: data.labels,\n            datasets: [{\n                label: 'Income',\n                data: data.income,\n                backgroundColor: '#198754',\n                borderColor: '#146c43',\n                borderWidth: 1\n            }, {\n                label: 'Expenses',\n                data: data.expenses,\n                backgroundColor: '#dc3545',\n                borderColor: '#b02a37',\n                borderWidth: 1\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            aspectRatio: 2,\n            layout: {\n                padding: {\n                    top: 10,\n                    bottom: 10\n                }\n            },\n            scales: {\n                x: {\n                    ticks: {\n                        color: textColor\n                    },\n                    grid: {\n                        color: gridColor\n                    }\n                },\n                y: {\n                    beginAtZero: true,\n                    ticks: {\n                        color: textColor,\n                        callback: function(value) {\n                            return '$' + value.toFixed(2);\n                        }\n                    },\n                    grid: {\n                        color: gridColor\n                    }\n                }\n            },\n            plugins: {\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return context.dataset.label + ': $' + context.parsed.y.toFixed(2);\n                        }\n                    }\n                },\n                legend: {\n                    position: 'top',\n                    labels: {\n                        padding: 20,\n                        usePointStyle: true,\n                        color: textColor\n                    }\n                }\n            }\n        }\n    });\n}\n\nfunction loadCategoryChart(startDate = '', endDate = '') {\n    let url = '/api/category-data';\n    if (startDate && endDate) {\n        url += `?start_date=${startDate}&end_date=${endDate}`;\n    }\n    \n    fetch(url)\n        .then(response => response.json())\n        .then(data => {\n            createCategoryChart(data);\n        })\n        .catch(error => {\n            console.error('Error loading category chart data:', error);\n        });\n}\n\nfunction createCategoryChart(data) {\n    const ctx = document.getElementById('category-chart');\n    if (!ctx) return;\n    \n    if (categoryChart) {\n        categoryChart.destroy();\n    }\n    \n    if (data.labels.length === 0) {\n        ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);\n        return;\n    }\n    \n    const currentTheme = document.documentElement.getAttribute('data-theme');\n    const textColor = currentTheme === 'dark' ? '#f8f9fa' : '#212529';\n    const borderColor = currentTheme === 'dark' ? '#343a40' : '#ffffff';\n    \n    const colors = [\n        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',\n        '#9966FF', '#FF9F40', '#FF6384', '#36A2EB'\n    ];\n    \n    categoryChart = new Chart(ctx, {\n        type: 'pie',\n        data: {\n            labels: data.labels,\n            datasets: [{\n                data: data.data,\n                backgroundColor: colors.slice(0, data.labels.length),\n                borderColor: borderColor,\n                borderWidth: 2\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            aspectRatio: 1,\n            layout: {\n                padding: {\n                    top: 10,\n                    bottom: 10\n                }\n            },\n            plugins: {\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                            const percentage = ((context.parsed / total) * 100).toFixed(1);\n                            return context.label + ': $' + context.parsed.toFixed(2) + ' (' + percentage + '%)';\n                        }\n                    }\n                },\n                legend: {\n                    position: 'bottom',\n                    labels: {\n                        padding: 15,\n                        usePointStyle: true,\n                        color: textColor,\n                        font: {\n                            size: 11\n                        }\n                    }\n                }\n            }\n        }\n    });\n}\n\n// Date filter function\nfunction applyDateFilter() {\n    const startDate = document.getElementById('start-date').value;\n    const endDate = document.getElementById('end-date').value;\n    \n    if (startDate && endDate) {\n        loadSummaryData(startDate, endDate);\n        loadTransactions(startDate, endDate);\n        loadMonthlyChart(startDate, endDate);\n        loadCategoryChart(startDate, endDate);\n    } else {\n        alert('Please select both start and end dates');\n    }\n}\n\n// Add Transaction Page Functions\nfunction initializeAddTransaction() {\n    const typeSelect = document.getElementById('type');\n    const form = document.getElementById('transaction-form');\n    \n    if (typeSelect) {\n        typeSelect.addEventListener('change', updateCategoryOptions);\n    }\n    \n    if (form) {\n        form.addEventListener('submit', handleTransactionSubmit);\n    }\n}\n\n// Edit Transaction Functions\nfunction editTransaction(transactionId) {\n    // Fetch transaction details\n    fetch(`/api/transactions/${transactionId}`)\n        .then(response => response.json())\n        .then(data => {\n            if (data.error) {\n                showErrorToast(data.error);\n                return;\n            }\n            \n            // Populate edit form\n            document.getElementById('edit-transaction-id').value = data.id;\n            document.getElementById('edit-amount').value = data.amount;\n            document.getElementById('edit-type').value = data.type;\n            document.getElementById('edit-date').value = data.date;\n            document.getElementById('edit-notes').value = data.notes || '';\n            \n            // Update category options based on type\n            updateEditCategoryOptions(data.type, data.category);\n            \n            // Show modal\n            const modal = new bootstrap.Modal(document.getElementById('editTransactionModal'));\n            modal.show();\n        })\n        .catch(error => {\n            console.error('Error fetching transaction:', error);\n            showErrorToast('Error loading transaction details');\n        });\n}\n\nfunction updateEditCategoryOptions(selectedType, selectedCategory) {\n    const categorySelect = document.getElementById('edit-category');\n    categorySelect.innerHTML = '<option value=\"\">Select category...</option>';\n    \n    if (selectedType && categories[selectedType]) {\n        categories[selectedType].forEach(category => {\n            const option = document.createElement('option');\n            option.value = category;\n            option.textContent = category;\n            if (category === selectedCategory) {\n                option.selected = true;\n            }\n            categorySelect.appendChild(option);\n        });\n    }\n}\n\n// Delete Transaction Functions\nfunction deleteTransaction(transactionId) {\n    // Fetch transaction details for confirmation\n    fetch(`/api/transactions/${transactionId}`)\n        .then(response => response.json())\n        .then(data => {\n            if (data.error) {\n                showErrorToast(data.error);\n                return;\n            }\n            \n            // Show transaction details in delete modal\n            const detailsDiv = document.getElementById('delete-transaction-details');\n            detailsDiv.innerHTML = `\n                <strong>Date:</strong> ${formatDate(data.date)}<br>\n                <strong>Category:</strong> ${data.category}<br>\n                <strong>Type:</strong> ${data.type.charAt(0).toUpperCase() + data.type.slice(1)}<br>\n                <strong>Amount:</strong> ${formatCurrency(data.amount)}<br>\n                <strong>Notes:</strong> ${data.notes || 'None'}\n            `;\n            \n            // Set up delete confirmation\n            const confirmBtn = document.getElementById('confirm-delete-btn');\n            confirmBtn.onclick = () => confirmDeleteTransaction(transactionId);\n            \n            // Show modal\n            const modal = new bootstrap.Modal(document.getElementById('deleteTransactionModal'));\n            modal.show();\n        })\n        .catch(error => {\n            console.error('Error fetching transaction:', error);\n            showErrorToast('Error loading transaction details');\n        });\n}\n\nfunction confirmDeleteTransaction(transactionId) {\n    fetch(`/api/transactions/${transactionId}`, {\n        method: 'DELETE'\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            showSuccessToast('Transaction deleted successfully');\n            \n            // Close modal\n            const modal = bootstrap.Modal.getInstance(document.getElementById('deleteTransactionModal'));\n            modal.hide();\n            \n            // Refresh dashboard data\n            refreshDashboardData();\n        } else {\n            showErrorToast(data.error || 'Error deleting transaction');\n        }\n    })\n    .catch(error => {\n        console.error('Error deleting transaction:', error);\n        showErrorToast('Error deleting transaction');\n    });\n}\n\n// Handle edit transaction form submission\nfunction handleEditTransactionSubmit(e) {\n    e.preventDefault();\n    \n    const transactionId = document.getElementById('edit-transaction-id').value;\n    const transactionData = {\n        amount: parseFloat(document.getElementById('edit-amount').value),\n        type: document.getElementById('edit-type').value,\n        category: document.getElementById('edit-category').value,\n        date: document.getElementById('edit-date').value,\n        notes: document.getElementById('edit-notes').value || ''\n    };\n    \n    // Validate data\n    if (!transactionData.amount || !transactionData.type || !transactionData.category || !transactionData.date) {\n        showErrorToast('Please fill in all required fields');\n        return;\n    }\n    \n    // Submit updated transaction\n    fetch(`/api/transactions/${transactionId}`, {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(transactionData)\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            showSuccessToast('Transaction updated successfully');\n            \n            // Close modal\n            const modal = bootstrap.Modal.getInstance(document.getElementById('editTransactionModal'));\n            modal.hide();\n            \n            // Refresh dashboard data\n            refreshDashboardData();\n        } else {\n            showErrorToast(data.error || 'Error updating transaction');\n        }\n    })\n    .catch(error => {\n        console.error('Error updating transaction:', error);\n        showErrorToast('Error updating transaction');\n    });\n}\n\n// Refresh all dashboard data\nfunction refreshDashboardData() {\n    loadSummaryData();\n    loadTransactions();\n    loadCharts();\n}\n\nfunction updateCategoryOptions() {\n    const typeSelect = document.getElementById('type');\n    const categorySelect = document.getElementById('category');\n    \n    if (!typeSelect || !categorySelect) return;\n    \n    const selectedType = typeSelect.value;\n    categorySelect.innerHTML = '<option value=\"\">Select category...</option>';\n    \n    if (selectedType && categories[selectedType]) {\n        categories[selectedType].forEach(category => {\n            const option = document.createElement('option');\n            option.value = category;\n            option.textContent = category;\n            categorySelect.appendChild(option);\n        });\n    }\n}\n\nfunction handleTransactionSubmit(e) {\n    e.preventDefault();\n    \n    const formData = new FormData(e.target);\n    const transactionData = {\n        amount: parseFloat(formData.get('amount')),\n        type: formData.get('type'),\n        category: formData.get('category'),\n        date: formData.get('date'),\n        notes: formData.get('notes') || ''\n    };\n    \n    // Validate data\n    if (!transactionData.amount || !transactionData.type || !transactionData.category || !transactionData.date) {\n        showErrorToast('Please fill in all required fields');\n        return;\n    }\n    \n    // Submit transaction\n    fetch('/api/transactions', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(transactionData)\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            showSuccessToast();\n            e.target.reset();\n            // Set today's date again\n            const today = new Date().toISOString().split('T')[0];\n            document.getElementById('date').value = today;\n            // Clear category options\n            document.getElementById('category').innerHTML = '<option value=\"\">Select category...</option>';\n        } else {\n            showErrorToast(data.message || 'Error adding transaction');\n        }\n    })\n    .catch(error => {\n        console.error('Error:', error);\n        showErrorToast('Error adding transaction');\n    });\n}\n\n// Toast notification functions\nfunction showSuccessToast(message = 'Operation completed successfully!') {\n    const successMessageEl = document.getElementById('success-message');\n    if (successMessageEl) {\n        successMessageEl.textContent = message;\n    }\n    const toast = new bootstrap.Toast(document.getElementById('success-toast'));\n    toast.show();\n}\n\nfunction showErrorToast(message) {\n    const errorMessageEl = document.getElementById('error-message');\n    if (errorMessageEl) {\n        errorMessageEl.textContent = message;\n    }\n    const toast = new bootstrap.Toast(document.getElementById('error-toast'));\n    toast.show();\n}\n\n// Utility functions\nfunction formatCurrency(amount) {\n    return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD'\n    }).format(amount);\n}\n\nfunction formatDate(dateString) {\n    return new Date(dateString + 'T00:00:00').toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric'\n    });\n}\n\n// Theme Management Functions\nfunction initializeTheme() {\n    const themeToggle = document.getElementById('theme-toggle');\n    const savedTheme = localStorage.getItem('theme') || 'light';\n    \n    // Apply saved theme\n    document.documentElement.setAttribute('data-theme', savedTheme);\n    updateThemeIcon(savedTheme);\n    \n    // Add event listener for theme toggle\n    if (themeToggle) {\n        themeToggle.addEventListener('click', toggleTheme);\n    }\n    \n    // Listen for theme changes to update charts\n    const observer = new MutationObserver(function(mutations) {\n        mutations.forEach(function(mutation) {\n            if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {\n                // Re-render charts when theme changes\n                if (monthlyChart || categoryChart) {\n                    setTimeout(() => loadCharts(), 100); // Small delay to ensure theme CSS has applied\n                }\n            }\n        });\n    });\n    \n    observer.observe(document.documentElement, {\n        attributes: true,\n        attributeFilter: ['data-theme']\n    });\n}\n\nfunction toggleTheme() {\n    const currentTheme = document.documentElement.getAttribute('data-theme');\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n    \n    document.documentElement.setAttribute('data-theme', newTheme);\n    localStorage.setItem('theme', newTheme);\n    updateThemeIcon(newTheme);\n}\n\nfunction updateThemeIcon(theme) {\n    const themeToggle = document.getElementById('theme-toggle');\n    if (themeToggle) {\n        const icon = themeToggle.querySelector('i');\n        if (theme === 'dark') {\n            icon.className = 'bi bi-sun-fill';\n            themeToggle.title = 'Switch to light mode';\n        } else {\n            icon.className = 'bi bi-moon-fill';\n            themeToggle.title = 'Switch to dark mode';\n        }\n    }\n}\n\n// CSV Import/Export Functions\nfunction exportCSV() {\n    const startDate = document.getElementById('start-date').value;\n    const endDate = document.getElementById('end-date').value;\n    \n    let url = '/api/export/csv';\n    if (startDate && endDate) {\n        url += `?start_date=${startDate}&end_date=${endDate}`;\n    }\n    \n    // Create invisible link and trigger download\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = '';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    \n    showSuccessToast('CSV export started. Check your downloads folder.');\n}\n\nfunction importCSV(event) {\n    const file = event.target.files[0];\n    if (!file) return;\n    \n    const formData = new FormData();\n    formData.append('file', file);\n    \n    // Show loading state\n    const importBtn = document.querySelector('button[onclick*=\"csv-import\"]');\n    const originalText = importBtn.innerHTML;\n    importBtn.innerHTML = '<span class=\"spinner-border spinner-border-sm\" role=\"status\"></span> Importing...';\n    importBtn.disabled = true;\n    \n    fetch('/api/import/csv', {\n        method: 'POST',\n        body: formData\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            showSuccessToast(data.message);\n            refreshDashboardData(); // Reload all data\n        } else {\n            showErrorToast(data.error || 'Error importing CSV file');\n        }\n    })\n    .catch(error => {\n        console.error('Error importing CSV:', error);\n        showErrorToast('Error importing CSV file');\n    })\n    .finally(() => {\n        // Reset button state\n        importBtn.innerHTML = originalText;\n        importBtn.disabled = false;\n        \n        // Reset file input\n        event.target.value = '';\n    });\n}","size_bytes":26246}},"version":1}